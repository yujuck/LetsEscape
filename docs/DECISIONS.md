# 기술 결정 문서

프로젝트 진행 중 내린 주요 기술 결정들을 기록합니다.

---

## 2026-02 모노레포 구조 전환

### 배경
- 기존: 단일 NestJS 프로젝트
- 프론트엔드(Next.js) 추가 필요
- 공유 코드 관리 필요성

### 결정
**pnpm workspace + Turborepo 기반 모노레포 구조 채택**

### 구조
```
LetsEscape/
├── apps/
│   ├── web/          # Next.js 16 (App Router)
│   └── api/          # NestJS 11
├── packages/
│   ├── shared/       # 공유 타입/상수/유틸리티
│   ├── eslint-config/# ESLint 설정
│   └── tsconfig/     # TypeScript 설정
```

### 기술 스택
| 영역 | 기술 | 버전 |
|------|------|------|
| 모노레포 | pnpm + Turborepo | 10.x, 2.x |
| 프론트엔드 | Next.js, React | 16.x, 19.x |
| 스타일링 | Tailwind CSS | 4.x |
| 상태관리 | TanStack Query | 5.x |
| 백엔드 | NestJS | 11.x |

---

## 2026-02 데이터베이스 선택

### 배경
- 기존 경험: MongoDB (NoSQL)
- 프로젝트 데이터: 명확한 관계형 구조 (유저→리뷰→테마→매장)
- 필요 기능: 랭킹, 통계, 집계 쿼리

### 검토 옵션
| DB | 장점 | 단점 | 적합도 |
|----|------|------|--------|
| PostgreSQL | 관계형, 집계/통계, JSONB | 설정 필요 | ⭐⭐⭐⭐⭐ |
| MySQL | 익숙함, 호스팅 많음 | 기능 부족 | ⭐⭐⭐⭐ |
| MongoDB | 유연한 스키마 | 관계형에 부적합 | ⭐⭐ |

### 결정
**PostgreSQL + Supabase**

### 이유
1. **관계형 데이터**: 유저-리뷰-테마-매장 명확한 관계
2. **집계 쿼리**: 랭킹, 성공률 통계 필요
3. **Supabase 장점**:
   - PostgreSQL 기반
   - 무료 티어 (500MB DB)
   - 내장 인증 (소셜 로그인)
   - 실시간 구독 (예약 알림)
   - 관리 대시보드

---

## 2026-02 아키텍처 결정: 백엔드 중심 + Supabase 부가기능

### 배경
- 프로젝트 목적: **프론트엔드 + 백엔드 둘 다 경험**
- Supabase는 프론트에서 직접 DB 접근 가능 (BaaS)
- 하지만 백엔드 경험을 위해 NestJS를 적극 활용하고 싶음

### 검토한 옵션

#### Option A: Supabase 풀 활용
```
Next.js → Supabase 직접 (CRUD, Auth, Storage, Realtime)
    ↓
NestJS (복잡한 로직만)
```
- 장점: 빠른 개발, Supabase 이점 최대화
- 단점: 백엔드 경험 부족

#### Option B: 백엔드 중심
```
Next.js → NestJS API → Supabase (DB만)
```
- 장점: 백엔드 경험 충분
- 단점: Supabase 이점 활용 부족

#### Option C: 하이브리드 (채택)
```
Next.js → Supabase (Auth, Storage, Realtime만 직접)
    ↓
NestJS API (모든 CRUD + 비즈니스 로직)
    ↓
Supabase DB
```
- 장점: 백엔드 경험 + Supabase 강점 활용
- 단점: 약간의 복잡성

### 결정
**Option C: 하이브리드 구조 채택**

### 역할 분담

| 기능 | 처리 | 이유 |
|------|------|------|
| **인증 (Auth)** | Supabase 직접 | 소셜 로그인, 세션 관리 자동화 |
| **파일 업로드 (Storage)** | Supabase 직접 | presigned URL, 이미지 최적화 |
| **실시간 알림 (Realtime)** | Supabase 직접 | WebSocket 없이 실시간 기능 |
| **CRUD (테마/매장/리뷰)** | NestJS 경유 | 백엔드 경험, 비즈니스 로직 |
| **AI 기능** | NestJS 경유 | API 키 보호, 복잡한 로직 |
| **크롤링** | NestJS 경유 | 서버 사이드 작업 |

### 최종 아키텍처

```
┌─────────────────────────────────────────────────────────────┐
│                      Next.js (프론트엔드)                    │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐ │
│  │   Auth UI   │  │  Theme List │  │   Review Form       │ │
│  └──────┬──────┘  └──────┬──────┘  └──────────┬──────────┘ │
│         │                │                     │            │
└─────────┼────────────────┼─────────────────────┼────────────┘
          │                │                     │
          ▼                │                     │
┌─────────────────┐        │                     │
│  Supabase Auth  │        │                     │
│  (직접 호출)     │        │                     │
│  • 로그인        │        │                     │
│  • 회원가입      │        │                     │
│  • 소셜 로그인   │        │                     │
└────────┬────────┘        │                     │
         │ (토큰)          │                     │
         ▼                 ▼                     ▼
┌─────────────────────────────────────────────────────────────┐
│                      NestJS (백엔드 API)                     │
├─────────────────────────────────────────────────────────────┤
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │ Auth Guard   │  │Theme Service │  │Review Service│      │
│  │ (토큰 검증)   │  │              │  │              │      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
│                                                             │
│  ┌──────────────┐  ┌──────────────┐                        │
│  │  AI Service  │  │Crawl Service │                        │
│  │ (Claude API) │  │ (Puppeteer)  │                        │
│  └──────────────┘  └──────────────┘                        │
└─────────────────────────────┬───────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                        Supabase                              │
├─────────────────────────────────────────────────────────────┤
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐    │
│  │PostgreSQL│  │   Auth   │  │ Storage  │  │ Realtime │    │
│  │   (DB)   │  │  (인증)   │  │ (파일)   │  │ (알림)   │    │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘    │
└─────────────────────────────────────────────────────────────┘
```

### 데이터 흐름 예시

#### 1. 로그인
```
1. 사용자가 로그인 버튼 클릭
2. Next.js → Supabase Auth 직접 호출
3. Supabase가 JWT 토큰 발급
4. 토큰을 쿠키/스토리지에 저장
5. 이후 API 호출 시 토큰 포함
```

#### 2. 테마 목록 조회
```
1. Next.js → NestJS API (GET /themes)
2. NestJS → Supabase DB 쿼리
3. 결과 반환
```

#### 3. 리뷰 작성
```
1. Next.js → NestJS API (POST /reviews) + Auth 토큰
2. NestJS Auth Guard → Supabase Auth로 토큰 검증
3. NestJS → Supabase DB에 리뷰 저장
4. 결과 반환
```

#### 4. 이미지 업로드
```
1. Next.js → Supabase Storage 직접 업로드
2. URL 받아서 NestJS API로 전달 (리뷰 저장 시)
```

### 이 구조의 장점

1. **백엔드 학습 효과**
   - NestJS Controller, Service, Guard 직접 구현
   - API 설계, 유효성 검사, 에러 처리 경험
   - 인증 흐름 이해 (토큰 검증)

2. **Supabase 이점 유지**
   - Auth: 복잡한 인증 로직 위임
   - Storage: 파일 업로드 간편화
   - Realtime: 실시간 알림 쉽게 구현
   - 관리형 DB: 인프라 관리 불필요

3. **실무 패턴**
   - 실제로 많이 사용하는 하이브리드 구조
   - 포트폴리오에 "풀스택" 어필 가능

---

## 2026-02 AI 기능 기획

### 배경
- 사이드 프로젝트 차별화
- AI 기술 학습 및 적용

### 검토한 AI 기능

#### 1. AI 테마 추천 챗봇 ⭐ 1순위
```
사용자: "무섭지 않고 2인이 하기 좋은 스토리 위주 테마 추천해줘"
AI: 자연어 이해 → 조건 추출 → 테마 추천 + 설명
```
- 난이도: 중
- 임팩트: ⭐⭐⭐⭐⭐

#### 2. 리뷰 요약 & 인사이트 ⭐ 2순위
```
[테마명 - 리뷰 N개 AI 요약]
👍 긍정적 의견: ...
👎 개선점: ...
💡 팁: ...
```
- 난이도: 하
- 임팩트: ⭐⭐⭐⭐

#### 3. 자연어 검색 ⭐ 3순위
```
"강남역 근처 난이도 쉬운 테마" → 의도 파악 → 필터링
```
- 난이도: 중
- 임팩트: ⭐⭐⭐⭐

### 결정
**MVP 우선순위**: AI 테마 추천 챗봇 → 리뷰 요약 → 자연어 검색

### 기술 스택
- LLM: Claude API 또는 OpenAI API
- 프레임워크: LangChain (선택)
- 벡터 DB: Supabase pgvector (추후)
